# Simulation of additive SMPC based QR orthonormalisation using MPyC
## Reproduce the contents of this folder


### Install the relevant packages

We chose Conda for dependency management. Assuming you have conda installed on your computer  initialize the conda environment using

(In the parent folder)
```
conda env create -f environment.yml
```

### Create and navigate into the directory
```
mkdir simulation
cd simulation
```

### Generate some sample data
This script allows you to generate sample data. Unless you specify a valid filename, the script will generate a random gaussian data matrix. If you specify a valid file, this file will instead be split into the number of specified shards.

The script will also create output directories to store the local results from the simulated federated QR run.
```
python ../qr/src/setup_test_environment.py -f dummy.txt -p simulation_data -o random.tsv -s 3
python ../qr/src/setup_test_environment.py -f ../data/diabetes/diabetes.tsv -p simulation_diabetes -o diabetes.tsv -s 3
```

### Run the simulation code

The following command launches one of three clients. 
```-M``` is an MPyC option and defines the number of simulated clients
```-I``` is the IP Adress/Client ID of the client
```-k``` specifies one of the previously created input files
```-o``` is the output folder previously autogenerated 
```-p``` is the name of the output file.
 
 ```
 python ../qr/src/smpc_fed_qr.py -M3 -I0 -k simulation_data/data/0/random.tsv -o simulation_data/results/0 -p data.tsv
 ```
 
 The two other clients can be started in different terminals with the analougous call. Once all clients have connected the simulation will start automatically.
 ```
 python ../qr/src/smpc_fed_qr.py -M3 -I1 -k simulation_data/data/1/random.tsv -o simulation_data/results/1 -p data.tsv
 python ../qr/src/smpc_fed_qr.py -M3 -I2 -k simulation_data/data/2/random.tsv -o simulation_data/results/2 -p data.tsv
 ```
 
 ### Verify the correctness of the result
 In order to convince ourselves that the smpc version achieves reasonable accuracy, we compare the results, which we previously saved with the centralized implementaion of QR orthonormalisation.

 
